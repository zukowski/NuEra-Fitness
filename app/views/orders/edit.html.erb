<%= javascript_include_tag 'quick_quote', '/states' %>
<% @body_id = 'cart' %>

<h1><%= t("shopping_cart")%></h1>

<% if @order.line_items.empty? %>

  <%= hook :empty_cart do %>
    <p><%= t("your_cart_is_empty.") %></p>
    <p><%=link_to t("continue_shopping"), products_path, :class => 'button continue' %></p>
  <% end %>

<% else %>

  <%= form_for(@order, :url => update_cart_path, :html=>{:id=>'updatecart'}) do |order_form| %>
  <%= hook :inside_cart_form do %>

    <%= hook :cart_items do %>
      <%= render :partial => 'form', :locals => {:order_form => order_form} %>
    <% end %>
    <div id="subtotal">
      <h3><%= "#{t("subtotal")}: #{order_price(@order)}" %></h3>
      <h3 id="quick-quote"></h3>
      <div class="links">
        <%= link_to image_tag('/images/update.png') + t("update"), '#', :class => 'button checkout primary', :onclick => "$('form#updatecart').submit(); return false;" %>
        <%= link_to image_tag('/images/checkout.png') + t("checkout"), checkout_path, :class => 'button checkout primary' %>
      </div>
    </div>


  <% end %>
  <% end %>

  <%= form_tag quote_cart_path, :remote => true, :method => :post, :class => 'cart-quick-quote' do |f| %>
    <span id="country">
      <%= collection_select :address, :country_id, Country.all, :id, :name %>
    </span>
    <span id="state">
      <% state_elements = [
        collection_select(:address, :state_id, Country.find(Spree::Config[:default_country_id]).states,
                          :id, :name, {:include_blank => true},
                          {:class => "required"}) +
        text_field(:address, :state_name, :style => "display:none;", :disabled => true)
        ].join.gsub('"',"'").gsub("\n","")
      %>
      <script type="text/javascript">document.write("<%= raw state_elements %>");</script>
    </span>
    <span id="zip">
      <%= text_field :address, :zipcode %>
    </span>
    <span id="submit">
      <%= submit_tag "Get Quote", :class => 'button' %>
    </span>
    <hr />
  <% end %>
  
  <span id="continue"><%= link_to t("continue_shopping"), products_path, :class => 'button continue' %></span>
  <span id="empty"> <%= button_to t("empty_cart"), empty_cart_path, :method => :put, :class => 'button continue' %></span>
<% end %>

<style type="text/css">
form.cart-quick-quote { width: 300px; }
span#country select { width: 300px; }
span#state select { width: 300px; }
span#zip input { width: 295px; }
span#submit { height: 25px; margin-bottom: 5px; display:block; }
span#submit input { float: right; }
</style>
